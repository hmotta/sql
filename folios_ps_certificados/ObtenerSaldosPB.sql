select s.socioid,s.clavesocioint,(select coalesce(saldomov,0) from saldomov(s.socioid,'PB',current_date)) as SALDO_PB,s.estatussocio from socio s where  s.tiposocioid in ('02','05') and s.estatussocio=2 group by s.socioid,s.clavesocioint,s.estatussocio having (select coalesce(saldomov,0) from saldomov(s.socioid,'PB',current_date))>0;


select inversionid,i.depositoinversion,prestamoid,( select sum(monto_garantia) from prestamos pe  where pe.socioid=s.socioid and pe.claveestadocredito='001') as MontoGarantia,(select coalesce(saldomov,0) from saldomov(s.socioid,'AA',current_date)) as SALDO_AA,(select coalesce(saldomov,0) from saldomov(s.socioid,'P3',current_date)) as SALDO_P3 from prestamos p,socio s,inversion i where monto_garantia >0 and claveestadocredito='001' and p.socioid=s.socioid and s.socioid=i.socioid and depositoinversion<>retiroinversion and tipoinversionid='PSO' group by inversionid,s.socioid,prestamoid,monto_garantia,i.depositoinversion having (select coalesce(saldomov,0) from saldomov(s.socioid,'AA',current_date)) + (select coalesce(saldomov,0) from saldomov(s.socioid,'P3',current_date)) < ( select sum(monto_garantia) from prestamos pe  where pe.socioid=s.socioid and pe.claveestadocredito='001');